{
  "info": {
    "name": "LoanWise â€” Full API Collection",
    "_postman_id": "loanwise-full-api-collection-id",
    "description": "Comprehensive Postman collection for testing all LoanWise endpoints (Auth, Users, Loans, Lenders, Funding, Reports, Metadata, Notifications, Repayments, Admin, Exports). Uses Bearer token captured from /auth/login.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "base_url", "value": "https://localhost:7000" },
    { "key": "auth_token", "value": "" }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      { "key": "token", "value": "{{auth_token}}", "type": "string" }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Attach Authorization header automatically if auth_token is set",
          "if (pm.collectionVariables.get('auth_token')) {",
          "  pm.request.headers.upsert({ key: 'Authorization', value: 'Bearer ' + pm.collectionVariables.get('auth_token') });",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "Auth",
      "description": "Authentication: register, login, refresh. Login test captures JWT to collection variable.",
      "item": [
        {
          "name": "Register",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/api/auth/register", "host": ["{{base_url}}"], "path": ["api","auth","register"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Demo User\",\n  \"email\": \"demo.borrower@example.com\",\n  \"password\": \"Passw0rd!\",\n  \"role\": \"Borrower\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
                  "const json = pm.response.json();",
                  "pm.test('Login success flag true', function(){ pm.expect(json.success).to.be.true; });",
                  "if (json && json.data && json.data.token) {",
                  "  pm.collectionVariables.set('auth_token', json.data.token);",
                  "  console.log('Auth token set to collection variable.');",
                  "} else {",
                  "  console.warn('No token found in response.');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/api/auth/login", "host": ["{{base_url}}"], "path": ["api","auth","login"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"demo.borrower@example.com\",\n  \"password\": \"Passw0rd!\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Refresh Token",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/api/auth/refresh", "host": ["{{base_url}}"], "path": ["api","auth","refresh"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"REPLACE_WITH_REFRESH_TOKEN_IF_USED\"\n}"
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Get Current User (/api/users/me)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/users/me", "host": ["{{base_url}}"], "path": ["api","users","me"] }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Loans",
      "item": [
        {
          "name": "Apply Loan (Borrower)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/api/loans/apply", "host": ["{{base_url}}"], "path": ["api","loans","apply"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 10000,\n  \"durationInMonths\": 12,\n  \"purpose\": \"HomeImprovement\",\n  \"description\": \"Paint & flooring\",\n  \"monthlyIncome\": 3500\n}"
            }
          },
          "response": []
        },
        {
          "name": "Get Open Loans (Lender)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/loans/open", "host": ["{{base_url}}"], "path": ["api","loans","open"] }
          },
          "response": []
        },
        {
          "name": "Get My Loans (Borrower)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/loans/my", "host": ["{{base_url}}"], "path": ["api","loans","my"] }
          },
          "response": []
        },
        {
          "name": "Disburse Loan (Admin)",
          "request": {
            "method": "POST",
            "header": [],
            "url": { "raw": "{{base_url}}/api/loans/{{loanId}}/disburse", "host": ["{{base_url}}"], "path": ["api","loans",":loanId","disburse"], "variable": [{ "key": "loanId", "value": "REPLACE-LOAN-ID" }] }
          },
          "response": []
        },
        {
          "name": "Get Repayments by Loan (Borrower)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/loans/{{loanId}}/repayments", "host": ["{{base_url}}"], "path": ["api","loans",":loanId","repayments"], "variable": [{ "key": "loanId", "value": "REPLACE-LOAN-ID" }] }
          },
          "response": []
        },
        {
          "name": "Borrower Dashboard",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/loans/borrowers/dashboard", "host": ["{{base_url}}"], "path": ["api","loans","borrowers","dashboard"] }
          },
          "response": []
        },
        {
          "name": "Admin Loan Stats",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/loans/stats", "host": ["{{base_url}}"], "path": ["api","loans","stats"] }
          },
          "response": []
        },
        {
          "name": "Borrower Loan History",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/loans/borrowers/history?page=1&pageSize=25",
              "host": ["{{base_url}}"],
              "path": ["api","loans","borrowers","history"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "pageSize", "value": "25" }
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Funding",
      "item": [
        {
          "name": "Fund Loan (Lender)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/api/fundings/{{loanId}}", "host": ["{{base_url}}"], "path": ["api","fundings",":loanId"], "variable": [{ "key": "loanId", "value": "REPLACE-LOAN-ID" }] },
            "body": { "mode": "raw", "raw": "{\n  \"amount\": 1000\n}" }
          },
          "response": []
        },
        {
          "name": "Get My Fundings (Lender)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/fundings/my", "host": ["{{base_url}}"], "path": ["api","fundings","my"] }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Lenders",
      "item": [
        {
          "name": "Portfolio (Lender/Admin)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/lenders/portfolio", "host": ["{{base_url}}"], "path": ["api","lenders","portfolio"] }
          },
          "response": []
        },
        {
          "name": "Transactions (Lender/Admin)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/lenders/transactions?from=&to=&loanId=&borrowerId=&page=1&pageSize=25",
              "host": ["{{base_url}}"],
              "path": ["api","lenders","transactions"],
              "query": [
                { "key": "from", "value": "" },
                { "key": "to", "value": "" },
                { "key": "loanId", "value": "" },
                { "key": "borrowerId", "value": "" },
                { "key": "page", "value": "1" },
                { "key": "pageSize", "value": "25" }
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Lender Exports",
      "item": [
        {
          "name": "Export Transactions (CSV/XLSX)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/lenders/transactions/export?from=2025-01-01&to=2025-08-01&format=csv",
              "host": ["{{base_url}}"],
              "path": ["api","lenders","transactions","export"],
              "query": [
                { "key": "from", "value": "2025-01-01" },
                { "key": "to", "value": "2025-08-01" },
                { "key": "format", "value": "csv" }
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Repayments",
      "item": [
        {
          "name": "Make Repayment (Borrower)",
          "request": {
            "method": "POST",
            "header": [],
            "url": { "raw": "{{base_url}}/api/repayments/{{repaymentId}}/pay", "host": ["{{base_url}}"], "path": ["api","repayments",":repaymentId","pay"], "variable": [{ "key": "repaymentId", "value": "REPLACE-REPAYMENT-ID" }] }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Notifications",
      "item": [
        {
          "name": "List My Notifications",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/notifications", "host": ["{{base_url}}"], "path": ["api","notifications"] }
          },
          "response": []
        },
        {
          "name": "Mark Notification as Read",
          "request": {
            "method": "PUT",
            "header": [],
            "url": { "raw": "{{base_url}}/api/notifications/{{id}}/read", "host": ["{{base_url}}"], "path": ["api","notifications",":id","read"], "variable": [{ "key": "id", "value": "REPLACE-NOTIFICATION-ID" }] }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Admin",
      "item": [
        {
          "name": "Approve Loan",
          "request": {
            "method": "POST",
            "header": [],
            "url": { "raw": "{{base_url}}/api/admin/loans/{{loanId}}/approve", "host": ["{{base_url}}"], "path": ["api","admin","loans",":loanId","approve"], "variable": [{ "key": "loanId", "value": "REPLACE-LOAN-ID" }] }
          },
          "response": []
        },
        {
          "name": "Reject Loan (with reason)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/api/admin/loans/{{loanId}}/reject", "host": ["{{base_url}}"], "path": ["api","admin","loans",":loanId","reject"], "variable": [{ "key": "loanId", "value": "REPLACE-LOAN-ID" }] },
            "body": { "mode": "raw", "raw": "{\n  \"reason\": \"Insufficient documentation\"\n}" }
          },
          "response": []
        },
        {
          "name": "Check Overdue Repayments",
          "request": {
            "method": "POST",
            "header": [],
            "url": { "raw": "{{base_url}}/api/admin/repayments/check-overdue", "host": ["{{base_url}}"], "path": ["api","admin","repayments","check-overdue"] }
          },
          "response": []
        },
        {
          "name": "Get Users (paged/filterable)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/admin/users?page=1&pageSize=25&search=&sortBy=createdAt&sortDir=desc",
              "host": ["{{base_url}}"],
              "path": ["api","admin","users"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "pageSize", "value": "25" },
                { "key": "search", "value": "" },
                { "key": "sortBy", "value": "createdAt" },
                { "key": "sortDir", "value": "desc" }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Update User Status",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/api/admin/users/{{id}}/status", "host": ["{{base_url}}"], "path": ["api","admin","users",":id","status"], "variable": [{ "key": "id", "value": "REPLACE-USER-ID" }] },
            "body": { "mode": "raw", "raw": "{\n  \"isActive\": true\n}" }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Admin Reports",
      "item": [
        {
          "name": "Loans Report",
          "request": { "method": "GET", "header": [], "url": { "raw": "{{base_url}}/api/admin/reports/loans", "host": ["{{base_url}}"], "path": ["api","admin","reports","loans"] } },
          "response": []
        },
        {
          "name": "Repayments Report",
          "request": { "method": "GET", "header": [], "url": { "raw": "{{base_url}}/api/admin/reports/repayments", "host": ["{{base_url}}"], "path": ["api","admin","reports","repayments"] } },
          "response": []
        },
        {
          "name": "Fundings Report",
          "request": { "method": "GET", "header": [], "url": { "raw": "{{base_url}}/api/admin/reports/fundings", "host": ["{{base_url}}"], "path": ["api","admin","reports","fundings"] } },
          "response": []
        }
      ]
    },
    {
      "name": "Borrowers Risk & Docs",
      "item": [
        {
          "name": "Borrower Risk Summary (Borrower/Lender/Admin)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/borrowers/{{borrowerId}}/risk-summary", "host": ["{{base_url}}"], "path": ["api","borrowers",":borrowerId","risk-summary"], "variable": [{ "key": "borrowerId", "value": "REPLACE-BORROWER-ID" }] }
          },
          "response": []
        },
        {
          "name": "Verify KYC (Admin)",
          "request": {
            "method": "POST",
            "header": [],
            "url": { "raw": "{{base_url}}/api/admin/kyc/{{borrowerId}}/verify", "host": ["{{base_url}}"], "path": ["api","admin","kyc",":borrowerId","verify"], "variable": [{ "key": "borrowerId", "value": "REPLACE-BORROWER-ID" }] }
          },
          "response": []
        },
        {
          "name": "List Borrowers by KYC (Admin)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/admin/borrowers/by-kyc?status=Verified,Pending&search=&sortBy=scoreAt&sortDir=desc&page=1&pageSize=25",
              "host": ["{{base_url}}"],
              "path": ["api","admin","borrowers","by-kyc"],
              "query": [
                { "key": "status", "value": "Verified,Pending" },
                { "key": "search", "value": "" },
                { "key": "sortBy", "value": "scoreAt" },
                { "key": "sortDir", "value": "desc" },
                { "key": "page", "value": "1" },
                { "key": "pageSize", "value": "25" }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Download Repayment Plan PDF (Borrower/Admin)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/borrowers/loans/{{loanId}}/repayment-plan.pdf", "host": ["{{base_url}}"], "path": ["api","borrowers","loans",":loanId","repayment-plan.pdf"], "variable": [{ "key": "loanId", "value": "REPLACE-LOAN-ID" }] }
          },
          "response": []
        },
        {
          "name": "Download Loan Agreement PDF (Borrower/Admin)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/api/borrowers/loans/{{loanId}}/agreement.pdf", "host": ["{{base_url}}"], "path": ["api","borrowers","loans",":loanId","agreement.pdf"], "variable": [{ "key": "loanId", "value": "REPLACE-LOAN-ID" }] }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Metadata (Public)",
      "item": [
        {
          "name": "Loan Statuses",
          "request": { "method": "GET", "header": [], "url": { "raw": "{{base_url}}/api/metadata/loan-statuses", "host": ["{{base_url}}"], "path": ["api","metadata","loan-statuses"] } },
          "response": []
        },
        {
          "name": "Loan Purposes",
          "request": { "method": "GET", "header": [], "url": { "raw": "{{base_url}}/api/metadata/loan-purposes", "host": ["{{base_url}}"], "path": ["api","metadata","loan-purposes"] } },
          "response": []
        },
        {
          "name": "Risk Levels",
          "request": { "method": "GET", "header": [], "url": { "raw": "{{base_url}}/api/metadata/risk-levels", "host": ["{{base_url}}"], "path": ["api","metadata","risk-levels"] } },
          "response": []
        }
      ]
    }
  ]
}
